{% extends 'master.html' %}

{% block head %}

<style>

.tool-rotate {
  transform: rotate(180deg);
  transform-origin: center;
}

.tool-zoom {
  transform: scale(5); 
  transform-origin: top left;
}

.tool-blur {
  filter: blur(10px);
}

</style>

{% endblock %}

{% block content %}

  <div class="columns is-mobile" style="">

    <div class="column is-1">
      <aside class="menu has-text-centered">
        <ul>
          <li>
            <button class="button is-danger">
              <i class="mdi mdi-flashlight"></i>
            </button>
          </li>
          <br>
          <li>
            <button class="button is-danger">
              <i class="mdi mdi-blur"></i>
            </button>
          </li>
        </ul>
      </aside>
    </div>

    <div class="column tool-here" style="height: 100vh; display: flex;">
      <object id="website" type="text/html" data="{{html}}" style="width: 100%;" class="pr-4">
      </object>
    </div>

  </div>

<div class="modal" id="myModal">
  <div class="modal-background" style="background: transparent;"></div>
  <div class="modal-content">
    <input id="input" class="input is-rounded is-info has-text-centered" type="text" style="border:none; outline:none; color:white; background: rgba(50, 50, 100, 0.7); letter-spacing: 0.1rem;"/>
  </div>
  <button class="modal-close is-large" aria-label="close"></button>
</div>

<script>
const modal = document.getElementById("myModal");
document.addEventListener("keydown", function () {
  if (!modal.classList.contains("is-active") && event.key.length === 1 && event.key.match(/[a-zA-Z]/)) {
    modal.classList.add("is-active");
    const input = document.getElementById("input");
    input.value = "";
    input.focus();
    
  }
  if (event.key === "Escape") {
    modal.classList.remove("is-active");
  }
  if (event.key === "Enter") {
    const input = document.getElementById("input");
    console.log(input.value);
    // animation 
    {#modal.classList.remove("is-active");#}
  }
});
document.querySelectorAll(".modal-close, .modal-background").forEach((element) => {
  element.addEventListener("click", function () {
    const modal = document.getElementById("myModal");
    modal.classList.remove("is-active"); // Close the modal
  });
});
</script>

<script>
const objectElement = document.getElementById('website');

// Wait for the object to load its content
objectElement.addEventListener('load', function() {
    // Get the embedded document
    const embeddedDocument = objectElement.contentDocument || objectElement.contentWindow.document;

    // Access elements inside the embedded document
    const metaTag = embeddedDocument.querySelector('meta#answer');
    const answer = metaTag ? metaTag.getAttribute('answer') : null;

    console.log("Answer:", answer); // Logs: something
});
</script>

<script>
function processUrl(url) {
  url = url.replace(/^https?:\/\//, '');
  url = url.replace(/^www\./, '');
  return url.split('/')[0].split('?')[0];
}

const input = document.getElementById("input");

function handleInput(event) {
  if (event.key !== "Enter") return;
  const inputValue = processUrl(input.value);
  const placeholderValue = processUrl("reddit.com");

  if (inputValue === placeholderValue) {
    const inputRext = input.getBoundingClientRect();
    const x = inputRext.left + (inputRext.width / 2);
    const y = inputRext.top + (inputRext.height / 2);
    triggerConfetti(x, y);
    input.style.backgroundColor = "rgba(50, 50, 100, 0.7)";
  } else {
    input.style.backgroundColor = "rgba(150, 50, 50, 0.7)";
  }
}

input.addEventListener("keydown", handleInput);

function triggerConfetti(x, y) {
    const screenWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    const screenHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

    let defaults = {
        spread: 200,
        ticks: 200,
        gravity: 0,
        decay: 0.95,
        startVelocity: 15,
        origin: {x: x / screenWidth, y: y / screenHeight},
        colors: ['FFE400', 'FFBD00', 'E89400', 'FFCA6C', 'FDFFB8']
    };

    function shoot() {
        confetti({
            ...defaults,
            particleCount: 60,
            scalar: 1.2,
            shapes: ['star']
        });

        confetti({
            ...defaults,
            particleCount: 20,
            scalar: 0.75,
            shapes: ['circle']
        });
    }

    setTimeout(shoot, 0);
}
</script>

{% endblock %}
